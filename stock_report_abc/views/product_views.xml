<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>

        <!-- Vista tipo List para Productos con datos ABC -->
        <record id="view_product_product_abc_list" model="ir.ui.view">
            <field name="name">product.product.abc.list</field>
            <field name="model">product.product</field>
            <field name="arch" type="xml">
                <list string="Productos - Stock ABC" create="false">
                    <field name="id" column_invisible="True"/>
                    <field name="categ_line_name" string="Línea" optional="show"/>
                    <field name="categ_group_name" string="Grupo" optional="show"/>
                    <field name="categ_name" string="Artículo" optional="show"/>
                    <field name="display_name" string="Product" optional="show"/>
                    <field name="default_code" optional="show"/>
                    <field name="qty_available" optional="show"/>
                    <field name="avg_cost" optional="show"/>
                    <field name="costo_total" string="Costo Total" optional="show"/>

                    <field name="annual_sales_qty" optional="show"/>
                    <field name="abc_classification" optional="show"/>
                    <field name="months_with_sales_qty" optional="show"/>
                    <field name="has_historical_data" optional="show"/>

                    <!-- Ventas mensuales -->
                    <field name="sales_m_1" string="M12"/>
                    <field name="sales_m_2" string="M11"/>
                    <field name="sales_m_3" string="M10"/>
                    <field name="sales_m_4" string="M9"/>
                    <field name="sales_m_5" string="M8"/>
                    <field name="sales_m_6" string="M7"/>
                    <field name="sales_m_7" string="M6"/>
                    <field name="sales_m_8" string="M5"/>
                    <field name="sales_m_9" string="M4"/>
                    <field name="sales_m_10" string="M3"/>
                    <field name="sales_m_11" string="M2"/>
                    <field name="sales_m_12" string="M1"/>
                </list>
            </field>
        </record>

        <!-- Search view con agrupamiento -->
        <record id="view_product_product_abc_search" model="ir.ui.view">
            <field name="name">product.product.abc.search</field>
            <field name="model">product.product</field>
            <field name="arch" type="xml">
                <search string="Buscar productos ABC">
                    <!-- Estas búsquedas son las que salen en el dropdown -->
                    <field name="display_name" string="Producto"/>
                    <field name="default_code" string="Referencia interna"/>

                    <field name="categ_line_name" string="Línea"/>
                    <field name="categ_group_name" string="Grupo"/>
                    <field name="categ_name" string="Artículo"/>

                    <field name="abc_classification" string="Clasificación ABC"/>
                    <field name="months_with_sales_qty" string="Meses con ventas"/>

                    <filter name="display_name" string="Producto"/>
                    <filter name="default_code" string="Referencia interna"/>

                    <filter name="categ_line_name" string="Línea"/>
                    <filter name="categ_group_name" string="Grupo"/>
                    <filter name="categ_name" string="Artículo"/>

                    <filter name="abc_classification" string="Clasificación ABC"/>
                    <filter name="months_with_sales_qty" string="Meses con ventas"/>

                    <group expand="1" string="Agrupar por">
                        <filter name="group_abc"
                                string="Clasificación ABC"
                                context="{'group_by': 'abc_classification'}"/>
                        <filter name="group_months_with_sales_qty"
                                string="Mes con ventas"
                                context="{'group_by': 'months_with_sales_qty'}"/>
                    </group>
                </search>
            </field>
        </record>

        <!-- Acción con la vista de lista y búsqueda -->
        <record id="stock_abc_product_normal_action" model="ir.actions.act_window">
            <field name="name">Clasificación ABC</field>
            <field name="type">ir.actions.act_window</field>
            <field name="res_model">product.product</field>
            <field name="view_mode">list</field>
            <field name="domain">[('type', '!=', 'service')]</field>
            <field name="view_id" ref="view_product_product_abc_list"/>
            <field name="search_view_id" ref="view_product_product_abc_search"/>
        </record>

        <!-- Menú -->
        <menuitem id="menu_product_stock_abc" name="Clasificación ABC" action="stock_abc_product_normal_action"
            parent="stock.menu_warehouse_report" sequence="9999"/>
    </data>
</odoo>
